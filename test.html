<html>
<body>
<script>
    let _log = console.log;
    console.log = (...args) => {
        window.parent.postMessage({_type: 'logs', logParams: args, renderTime: 2}, '*');
        _log.apply(this, args);
    }
    try {

        let global = window;

        console.log('START:  promiseWithTimeout(delay(400),3000)');


        global.SCRIPT_START_TIME = global.SCRIPT_START_TIME || new Date().getTime();

        global.delay = (ms) => {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    onPushSmartLogs('Completed: ' + ms + 'ms')
                    resolve(ms);
                }, ms)
            })
        }

        global.timer = (cd) => {
            return +((new Date().getTime() - cd) / 1000).toFixed(1) + 's'
        }

        global.smartLogs = (...args) => {
            onPushSmartLogs(args)
        }
        global.log = (msg) => {
            return function () {
                // console.log("logsssss", msg)
                onPushSmartLogs(msg)
            }
        }

        global.logReader = (msg) => {
            console.log('aaaaa', msg)
            global.results.push(msg)

        }

        function onPushSmartLogs(value) {
            global.autoLogResults = global.autoLogResults || [];
            global.autoLogResults.push({ value, ms: timer(SCRIPT_START_TIME) })
        }



        function promiseWithTimeout(promise, timeout) {
            let timeoutId;

            console.log('promises', promise)
            const timeoutPromise = new Promise((resolve, reject) => {
                console.log("timeout")
                timeoutId = setTimeout(() => {
                    reject(new Error('Timeout Error'));
                }, timeout);
            });

            return Promise.race([promise, timeoutPromise]).then((result) => {
                console.log('race timer')
                clearTimeout(timeoutId);
                return result;
            });
        }

        let res = null;
        (async function asyncWrap(){
            try {
                res = await promiseWithTimeout(delay(400), 3000);
                console.log('RESPONSE: ', res);

            } catch(e) {
                console.log('TRY CATCH ERROR:: ', e.toString(), e);
            }
        })();

    } catch(e) {
        console.log(e.toString());
    }</script><pre>try {

let global = window;

console.log('START:  promiseWithTimeout(delay(400),3000)');


global.SCRIPT_START_TIME = global.SCRIPT_START_TIME || new Date().getTime();

global.delay = (ms) => {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            onPushSmartLogs('Completed: ' + ms + 'ms')
            resolve(ms);
        }, ms)
    })
}

global.timer = (cd) => {
    return +((new Date().getTime() - cd) / 1000).toFixed(1) + 's'
}

global.smartLogs = (...args) => {
    onPushSmartLogs(args)
}
global.log = (msg) => {
    return function () {
        // console.log("logsssss", msg)
        onPushSmartLogs(msg)
    }
}

global.logReader = (msg) => {
    console.log('aaaaa', msg)
    global.results.push(msg)

}

function onPushSmartLogs(value) {
    global.autoLogResults = global.autoLogResults || [];
    global.autoLogResults.push({ value, ms: timer(SCRIPT_START_TIME) })
}



function promiseWithTimeout(promise, timeout) {
  let timeoutId;

  console.log('promises', promise)
  const timeoutPromise = new Promise((resolve, reject) => {
    console.log("timeout")
    timeoutId = setTimeout(() => {
      reject(new Error('Timeout Error'));
    }, timeout);
  });

  return Promise.race([promise, timeoutPromise]).then((result) => {
    console.log('race timer')
    clearTimeout(timeoutId);
    return result;
  });
}

let res = null;
(async function asyncWrap(){
    try {
        res = await promiseWithTimeout(delay(400), 3000);
        console.log('RESPONSE: ', res);

    } catch(e) {
        console.log('TRY CATCH ERROR:: ', e.toString(), e);
    }
})();

} catch(e) {
    console.log(e.toString());
}</pre>
</body>
</html>